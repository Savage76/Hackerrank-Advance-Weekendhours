--WEEKEND HOURS WORKED

--The times that employees log in and out are recorded over the course of a month.For each employee, determine the number of hours worked during the weekends .For simplicity ,hours worked in a day ,hours are truncated to their integral part.


--For example, there are 10 hours between '2000:01:01 00:45:00' and '2000:01:01 10:45:00'.There are 9hours between '2000:01:01 00:46:00' and '2000:01:01 10:45:00'.



--Return a lsit of employee ids and weekend hours worked, descending by hours worked.





CREATE TABLE [attendance] ([timestamp] VARCHAR(20),[emp_id] SMALLINT);
INSERT INTO [attendance] ([timestamp],[emp_id]) VALUES 
 ('2022-05-20 08:19:32','123'), 
 ('2022-05-20 16:19:32','123'), 
 ('2022-05-21 08:19:32','123'), 
 ('2022-05-21 16:19:32','123'), 
 ('2022-05-22 08:19:32','123'), 
 ('2022-05-22 16:19:32','123'), 
 ('2022-05-23 08:19:32','123'), 
 ('2022-05-23 16:19:32','123'), 
 ('2022-05-24 08:19:32','123'), 
 ('2022-05-24 16:19:32','123'), 
 ('2022-05-25 08:19:32','123'), 
 ('2022-05-25 16:19:32','123'), 
 ('2022-05-26 08:19:32','123'), 
 ('2022-05-26 16:19:32','123'), 
 ('2022-05-27 08:19:32','123'), 
 ('2022-05-27 16:19:32','123'), 
 ('2022-05-28 08:19:32','123'), 
 ('2022-05-28 16:19:32','123'), 
 ('2022-05-29 08:04:32','123'), 
 ('2022-05-29 18:19:32','123'), 
 ('2022-05-30 08:04:32','456'), 
 ('2022-05-30 18:19:32','456'), 
 ('2022-05-31 08:04:32','456'), 
 ('2022-05-31 18:19:32','456'), 
 ('2022-06-01 08:04:32','456'), 
 ('2022-06-01 18:19:32','456'), 
 ('2022-06-02 08:04:32','456'), 
 ('2022-06-02 18:19:32','456'), 
 ('2022-06-03 08:04:32','456'), 
 ('2022-06-03 18:19:32','456'), 
 ('2022-06-04 08:04:32','456'), 
 ('2022-06-04 18:19:32','456'), 
 ('2022-06-05 08:04:32','456'), 
 ('2022-06-05 18:19:32','456'), 
 ('2022-06-06 08:04:32','456'), 
 ('2022-06-06 18:19:32','456'), 
 ('2022-06-07 08:04:32','456'), 
 ('2022-06-07 18:19:32','456'), 
 ('2022-06-08 09:19:32','456'), 
 ('2022-06-08 20:19:32','456'), 
 ('2022-06-09 09:19:32','456'), 
 ('2022-06-09 20:19:32','456'), 
 ('2022-06-10 09:19:32','456'), 
 ('2022-06-10 20:19:32','456'), 
 ('2022-06-11 09:19:32','789'), 
 ('2022-06-11 20:19:32','789'), 
 ('2022-06-12 09:19:32','789'), 
 ('2022-06-12 20:19:32','789'), 
 ('2022-06-13 09:19:32','789'), 
 ('2022-06-13 20:19:32','789'), 
 ('2022-06-14 09:19:32','789'), 
 ('2022-06-14 20:19:32','789'), 
 ('2022-06-15 09:19:32','789'), 
 ('2022-06-15 20:19:32','789'), 
 ('2022-06-16 09:19:32','789'), 
 ('2022-06-16 20:19:32','789'), 
 ('2022-06-17 09:19:32','789'), 
 ('2022-06-17 20:19:32','789'), 
 ('2022-06-18 10:10:32','789'), 
 ('2022-06-18 19:19:32','789'), 
 ('2022-06-19 10:10:32','789'), 
 ('2022-06-19 19:19:32','789'), 
 ('2022-06-20 10:10:32','789'), 
 ('2022-06-20 19:19:32','789'), 
 ('2022-06-21 10:10:32','789'), 
 ('2022-06-21 19:19:32','789'), 
 ('2022-06-22 10:10:32','789'), 
 ('2022-06-22 19:19:32','789'), 
 ('2022-06-23 10:10:32','789'), 
 ('2022-06-23 19:19:32','789'), 
 ('2022-06-24 10:10:32','444'), 
 ('2022-06-24 19:19:32','444'), 
 ('2022-06-25 10:10:32','444'), 
 ('2022-06-25 19:19:32','444'), 
 ('2022-06-26 10:10:32','444'), 
 ('2022-06-26 19:19:32','444'), 
 ('2022-06-27 10:10:32','444'), 
 ('2022-06-27 19:19:32','444'), 
 ('2022-06-28 12:19:32','444'), 
 ('2022-06-28 15:19:32','444'), 
 ('2022-06-29 12:19:32','444'), 
 ('2022-06-29 15:19:32','444'), 
 ('2022-06-30 12:19:32','444'), 
 ('2022-06-30 15:19:32','444'), 
 ('2022-07-01 12:19:32','444'), 
 ('2022-07-01 15:19:32','444'), 
 ('2022-07-02 12:19:32','444'), 
 ('2022-07-02 15:19:32','444'), 
 ('2022-07-03 12:19:32','444'), 
 ('2022-07-03 15:19:32','444'), 
 ('2022-07-04 12:19:32','444'), 
 ('2022-07-04 15:19:32','444'), 
 ('2022-07-05 12:19:32','444'), 
 ('2022-07-05 15:19:32','444'), 
 ('2022-07-06 12:19:32','234'), 
 ('2022-07-06 15:19:32','234'), 
 ('2022-07-07 12:19:32','234'), 
 ('2022-07-07 15:19:32','234'), 
 ('2022-07-08 09:19:32','234'), 
 ('2022-07-08 13:19:32','234'), 
 ('2022-07-09 09:19:32','234'), 
 ('2022-07-09 13:19:32','234'), 
 ('2022-07-10 09:19:32','234'), 
 ('2022-07-10 13:19:32','234'), 
 ('2022-07-11 09:19:32','234'), 
 ('2022-07-11 13:19:32','234'), 
 ('2022-07-12 09:19:32','234'), 
 ('2022-07-12 13:19:32','234'), 
 ('2022-07-13 09:19:32','234'), 
 ('2022-07-13 13:19:32','234'), 
 ('2022-07-14 09:19:32','234'), 
 ('2022-07-14 13:19:32','234'), 
 ('2022-07-15 09:19:32','234'), 
 ('2022-07-15 13:19:32','234'), 
 ('2022-07-16 09:19:32','234'), 
 ('2022-07-16 13:19:32','234'), 
 ('2022-07-17 09:19:32','234'), 
 ('2022-07-17 13:19:32','234'), 
 ('2022-07-18 08:35:32','234'), 
 ('2022-07-18 21:19:32','234'), 
 ('2022-07-19 08:35:32','463'), 
 ('2022-07-19 21:19:32','463'), 
 ('2022-07-20 08:35:32','463'), 
 ('2022-07-20 21:19:32','463'), 
 ('2022-07-21 08:35:32','463'), 
 ('2022-07-21 21:19:32','463'), 
 ('2022-07-22 08:35:32','463'), 
 ('2022-07-22 21:19:32','463'), 
 ('2022-07-23 08:35:32','463'), 
 ('2022-07-23 21:19:32','463'), 
 ('2022-07-24 08:35:32','463'), 
 ('2022-07-24 21:19:32','463'), 
 ('2022-07-25 08:35:32','463'), 
 ('2022-07-25 21:19:32','463'), 
 ('2022-07-26 08:35:32','463'), 
 ('2022-07-26 21:19:32','463'), 
 ('2022-07-27 08:35:32','463'), 
 ('2022-07-27 21:19:32','463'), 
 ('2022-07-28 06:19:32','463'), 
 ('2022-07-28 22:19:32','463'), 
 ('2022-07-29 06:19:32','463'), 
 ('2022-07-29 22:19:32','463'), 
 ('2022-07-30 06:19:32','463'), 
 ('2022-07-30 22:19:32','463'), 
 ('2022-07-31 06:19:32','463'), 
 ('2022-07-31 22:19:32','463'), 
 ('2022-08-01 06:19:32','289'), 
 ('2022-08-01 22:19:32','289'), 
 ('2022-08-02 06:19:32','289'), 
 ('2022-08-02 22:19:32','289'), 
 ('2022-08-03 06:19:32','289'), 
 ('2022-08-03 22:19:32','289'), 
 ('2022-08-04 06:19:32','289'), 
 ('2022-08-04 22:19:32','289'), 
 ('2022-08-05 06:19:32','289'), 
 ('2022-08-05 22:19:32','289'), 
 ('2022-08-06 06:19:32','289'), 
 ('2022-08-06 22:19:32','289'), 
 ('2022-08-07 08:19:32','289'), 
 ('2022-08-07 16:19:32','289'), 
 ('2022-08-08 08:19:32','289'), 
 ('2022-08-08 16:19:32','289'), 
 ('2022-08-09 08:19:32','289'), 
 ('2022-08-09 16:19:32','289'), 
 ('2022-08-10 08:19:32','289'), 
 ('2022-08-10 16:19:32','289'), 
 ('2022-08-11 08:19:32','289'), 
 ('2022-08-11 16:19:32','289'), 
 ('2022-08-12 08:19:32','289'), 
 ('2022-08-12 16:19:32','289'), 
 ('2022-08-13 08:19:32','289'), 
 ('2022-08-13 16:19:32','289'), 
 ('2022-08-14 08:19:32','289'), 
 ('2022-08-14 16:19:32','289'), 
 ('2022-08-15 08:19:32','289'), 
 ('2022-08-15 16:19:32','289'), 
 ('2022-08-16 08:19:32','289'), 
 ('2022-08-16 16:19:32','289'), 
 ('2022-08-17 08:19:32','289'), 
 ('2022-08-17 16:19:32','289'), 
 ('2022-08-18 08:19:32','289'), 
 ('2022-08-18 16:19:32','289'), 
 ('2022-08-19 08:19:32','289'), 
 ('2022-08-19 16:19:32','289'), 
 ('2022-08-20 08:19:32','289'), 
 ('2022-08-20 16:19:32','289'), 
 ('2022-08-21 08:19:32','289'), 
 ('2022-08-21 16:19:32','289'), 
 ('2022-08-22 08:19:32','999'), 
 ('2022-08-22 16:19:32','999'), 
 ('2022-08-23 08:19:32','999'), 
 ('2022-08-23 16:19:32','999'), 
 ('2022-08-24 08:19:32','999'), 
 ('2022-08-24 16:19:32','999'), 
 ('2022-08-25 08:19:32','999'), 
 ('2022-08-25 16:19:32','999'), 
 ('2022-08-26 08:19:32','999'), 
 ('2022-08-26 16:19:32','999'), 
 ('2022-08-27 08:19:32','999'), 
 ('2022-08-27 16:19:32','999');


 select timestamp,emp_id
 from attendance;

 
with hours_worked as ( 
 
select 
datepart(hour,timestamp) as hour,
datepart(hour,lag(timestamp)over(partition by cast(timestamp as date),emp_id order by timestamp)) as lag_hour,
datepart(hour,timestamp) - datepart(hour,lag(timestamp)over(partition by cast(timestamp as date),emp_id order by timestamp)) as hours_worked
 from attendance
 where datepart(weekday,timestamp) in (7,1))


 select 
 emp_id,
 sum(hours_worked) as hours_worked
 from attendance
 group by emp_id
 order by hours_worked desc;



